<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENSEI ‚Äî ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Playbook</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* === Playbook Editor Specific Styles === */
        .editor-layout {
            display: grid;
            grid-template-columns: 1fr 360px;
            gap: 20px;
            align-items: start;
        }

        .editor-layout.config-hidden {
            grid-template-columns: 1fr;
        }

        .editor-layout.config-hidden .config-panel {
            display: none;
        }

        /* Playbook Header */
        .playbook-editor-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            margin-bottom: 20px;
            box-shadow: var(--shadow-sm);
        }

        .playbook-editor-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .playbook-editor-title h2 {
            font-size: 18px;
            font-weight: 700;
        }

        .playbook-editor-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 4px;
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        /* Pipeline */
        .pipeline {
            position: relative;
        }

        /* Step Card */
        .step-card {
            background: var(--color-white);
            border: 2px solid var(--color-border);
            border-radius: var(--radius-lg);
            margin-bottom: 0;
            position: relative;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .step-card:hover {
            border-color: #D1D5DB;
            box-shadow: var(--shadow-md);
        }

        .step-card.selected {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(232, 98, 44, 0.15);
        }

        .step-card.locked {
            border-left: 4px solid #9CA3AF;
        }

        .step-card.dragging {
            opacity: 0.5;
            border-style: dashed;
        }

        .step-card.drag-over {
            border-color: var(--color-primary);
            border-style: dashed;
            background: var(--color-primary-light);
        }

        .step-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            cursor: pointer;
        }

        .step-drag-handle {
            cursor: grab;
            color: var(--color-text-tertiary);
            font-size: 18px;
            padding: 4px;
            user-select: none;
            flex-shrink: 0;
        }

        .step-drag-handle:active {
            cursor: grabbing;
        }

        .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--color-primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 13px;
            flex-shrink: 0;
        }

        .step-card.locked .step-number {
            background: #9CA3AF;
        }

        .step-info {
            flex: 1;
        }

        .step-name {
            font-weight: 600;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-timing {
            font-size: 12px;
            color: var(--color-text-secondary);
            margin-top: 2px;
        }

        .step-actions {
            display: flex;
            gap: 4px;
            flex-shrink: 0;
        }

        .step-action-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            color: var(--color-text-tertiary);
        }

        .step-action-btn:hover {
            background: var(--color-bg);
            color: var(--color-text-primary);
        }

        .step-action-btn.delete:hover {
            background: var(--color-danger-light);
            color: var(--color-danger);
        }

        /* Outcome Transitions (inside step card) */
        .step-outcomes {
            border-top: 1px solid var(--color-border);
            padding: 0 16px 14px 16px;
        }

        .step-outcomes-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--color-text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 10px 0 8px 0;
        }

        .outcome-row {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 0;
            font-size: 13px;
            border-bottom: 1px solid #F3F4F6;
        }

        .outcome-row:last-child {
            border-bottom: none;
        }

        .outcome-label {
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 140px;
            font-weight: 500;
        }

        .outcome-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .outcome-dot.green {
            background: var(--color-success);
        }

        .outcome-dot.red {
            background: var(--color-danger);
        }

        .outcome-dot.orange {
            background: var(--color-primary);
        }

        .outcome-dot.blue {
            background: var(--color-info);
        }

        .outcome-dot.gray {
            background: #9CA3AF;
        }

        .outcome-dot.yellow {
            background: var(--color-warning);
        }

        .outcome-arrow {
            color: var(--color-text-tertiary);
            font-size: 12px;
            flex-shrink: 0;
        }

        .outcome-target {
            flex: 1;
            font-size: 12px;
            padding: 4px 10px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            background: var(--color-bg);
            cursor: pointer;
            transition: var(--transition);
            font-family: var(--font-family);
            color: var(--color-text-secondary);
        }

        .outcome-target:hover {
            border-color: var(--color-primary);
            background: var(--color-primary-light);
        }

        .outcome-target.success {
            border-color: var(--color-success);
            color: #15803D;
            background: var(--color-success-light);
        }

        .outcome-target.danger {
            border-color: var(--color-danger);
            color: var(--color-danger);
            background: var(--color-danger-light);
        }

        /* Connector between steps */
        .step-connector {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 36px;
            position: relative;
        }

        .step-connector::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--color-border);
            transform: translateX(-50%);
        }

        .step-connector .add-step-btn {
            position: relative;
            z-index: 1;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--color-border);
            background: var(--color-white);
            color: var(--color-text-tertiary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: var(--transition);
            opacity: 0;
        }

        .step-connector:hover .add-step-btn {
            opacity: 1;
        }

        .step-connector .add-step-btn:hover {
            border-color: var(--color-primary);
            color: var(--color-primary);
            background: var(--color-primary-light);
        }

        /* Config Panel */
        .config-panel {
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 76px;
        }

        .config-panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .config-panel-title {
            font-weight: 600;
            font-size: 14px;
        }

        .config-panel-body {
            padding: 20px;
        }

        .config-section {
            margin-bottom: 20px;
        }

        .config-section:last-child {
            margin-bottom: 0;
        }

        .config-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .config-select {
            width: 100%;
            height: 36px;
            border: 1px solid var(--color-border);
            border-radius: var(--radius-sm);
            padding: 0 12px;
            font-family: var(--font-family);
            font-size: 13px;
            background: var(--color-white);
            cursor: pointer;
        }

        .config-select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .config-info {
            padding: 10px 12px;
            background: var(--color-bg);
            border-radius: var(--radius-sm);
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        /* Footer Bar */
        .editor-footer {
            position: fixed;
            bottom: 0;
            left: 68px;
            right: 0;
            padding: 12px 24px;
            background: var(--color-white);
            border-top: 1px solid var(--color-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 50;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
        }

        .editor-footer-left {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--color-text-secondary);
        }

        .unsaved-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--color-warning);
            display: inline-block;
        }

        /* Add step modal (simple inline) */
        .add-step-dropdown {
            position: absolute;
            z-index: 200;
            background: var(--color-white);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            padding: 8px;
            width: 220px;
            left: 50%;
            transform: translateX(-50%);
            top: 32px;
            display: none;
        }

        .add-step-dropdown.visible {
            display: block;
        }

        .add-step-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 13px;
            transition: var(--transition);
            border: none;
            background: none;
            width: 100%;
            font-family: var(--font-family);
            text-align: left;
        }

        .add-step-option:hover {
            background: var(--color-primary-light);
            color: var(--color-primary);
        }

        .page-content {
            padding-bottom: 80px;
        }
    </style>
</head>

<body>
    <div class="app-layout">
        <nav class="sidebar">
            <div class="sidebar-logo">S</div>
            <div class="sidebar-nav">
                <a href="customer-list.html" title="‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">üë•</a>
                <a href="work-queue.html" title="‡∏Ñ‡∏¥‡∏ß‡∏á‡∏≤‡∏ô">üìã</a>
                <a href="supervisor.html" class="active" title="‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î">üìä</a>
                <a href="performance.html" title="‡∏ú‡∏•‡∏á‡∏≤‡∏ô">üèÜ</a>
            </div>
            <div class="sidebar-divider"></div>
            <div class="sidebar-nav">
                <a href="#" title="‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤">‚öôÔ∏è</a>
            </div>
        </nav>

        <main class="main-content">
            <header class="top-header">
                <div class="top-header-left">
                    <div class="top-header-title">SENSEI</div>
                    <div class="top-header-breadcrumb">
                        <a href="supervisor.html">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</a>
                        <span>/</span>
                        <a href="supervisor.html">Playbooks</a>
                        <span>/</span>
                        <span style="color:var(--color-text-primary)">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Playbook</span>
                    </div>
                </div>
                <div class="top-header-right">
                    <span style="font-size:13px;color:var(--color-text-secondary)">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡∏ó ‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤</span>
                    <div class="user-avatar">‡∏ô</div>
                </div>
            </header>

            <div class="page-content">
                <!-- Playbook Header -->
                <div class="playbook-editor-header">
                    <div class="playbook-editor-title">
                        <span style="font-size:24px;">üî¥</span>
                        <div>
                            <h2>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞</h2>
                            <div class="playbook-editor-meta">
                                <span class="tag tag-orange">‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡∏£‡∏±‡∏ä‡∏î‡∏≤</span>
                                <span>¬∑</span>
                                <span>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö v3</span>
                                <span>¬∑</span>
                                <span>7 ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</span>
                            </div>
                        </div>
                    </div>
                    <div style="display:flex;gap:8px;">
                        <button class="btn btn-outline btn-sm">üëÅÔ∏è ‡∏î‡∏π‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</button>
                        <button class="btn btn-outline btn-sm">‚Üª ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
                    </div>
                </div>

                <!-- Editor Layout -->
                <div class="editor-layout" id="editorLayout">
                    <!-- Left: Step Pipeline -->
                    <div class="pipeline" id="pipeline">

                        <!-- STEP 1 -->
                        <div class="step-card" draggable="true" data-step="1" onclick="selectStep(this, 1)">
                            <div class="step-card-header">
                                <span class="step-drag-handle" title="‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö">‚†ø</span>
                                <div class="step-number">1</div>
                                <div class="step-info">
                                    <div class="step-name">üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1</div>
                                    <div class="step-timing">Day 1 ¬∑ Same CO ¬∑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
                                </div>
                                <div class="step-actions">
                                    <button class="step-action-btn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
                                        onclick="event.stopPropagation(); selectStep(this.closest('.step-card'), 1)">‚úèÔ∏è</button>
                                    <button class="step-action-btn delete" title="‡∏•‡∏ö"
                                        onclick="event.stopPropagation()">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="step-outcomes">
                                <div class="step-outcomes-label">Outcome Transitions</div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot green"></span> PTP</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target success">‚úÖ ‡∏à‡∏ö Playbook (‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot red"></span> ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">üîÑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (max 3) ‡πÅ‡∏•‡πâ‡∏ß ‚Üí Step 5</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot red"></span> ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏ä‡∏≥‡∏£‡∏∞</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target danger">‚è≠Ô∏è Step 6: üìã ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot orange"></span> ‡∏ô‡∏±‡∏î‡πÇ‡∏ó‡∏£‡∏Å‡∏•‡∏±‡∏ö</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">‚è≠Ô∏è Step 3: ‚è≥ ‡∏£‡∏≠ (‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î)</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot gray"></span> ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ú‡∏¥‡∏î</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target danger">‚è≠Ô∏è Step 6: üìã ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot blue"></span> Default</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">‚è≠Ô∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                                </div>
                            </div>
                        </div>

                        <!-- Connector -->
                        <div class="step-connector">
                            <button class="add-step-btn" onclick="toggleAddMenu(this)" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô">+</button>
                            <div class="add-step-dropdown">
                                <button class="add-step-option" onclick="addStep('call')">üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</button>
                                <button class="add-step-option" onclick="addStep('visit')">üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</button>
                                <button class="add-step-option" onclick="addStep('wait')">‚è≥ ‡∏£‡∏≠</button>
                                <button class="add-step-option" onclick="addStep('admin')">üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
                                <button class="add-step-option" onclick="addStep('notify')">üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤</button>
                                <button class="add-step-option" onclick="addStep('send')">üìß ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                            </div>
                        </div>

                        <!-- STEP 2 -->
                        <div class="step-card" draggable="true" data-step="2" onclick="selectStep(this, 2)">
                            <div class="step-card-header">
                                <span class="step-drag-handle">‚†ø</span>
                                <div class="step-number">2</div>
                                <div class="step-info">
                                    <div class="step-name">‚è≥ ‡∏£‡∏≠</div>
                                    <div class="step-timing">3 ‡∏ß‡∏±‡∏ô ¬∑ ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
                                </div>
                                <div class="step-actions">
                                    <button class="step-action-btn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
                                        onclick="event.stopPropagation(); selectStep(this.closest('.step-card'), 2)">‚úèÔ∏è</button>
                                    <button class="step-action-btn delete" title="‡∏•‡∏ö"
                                        onclick="event.stopPropagation()">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="step-outcomes">
                                <div class="step-outcomes-label">Outcome Transitions</div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot blue"></span> ‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">‚è≠Ô∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                                </div>
                            </div>
                        </div>

                        <div class="step-connector">
                            <button class="add-step-btn" onclick="toggleAddMenu(this)" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô">+</button>
                            <div class="add-step-dropdown">
                                <button class="add-step-option" onclick="addStep('call')">üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</button>
                                <button class="add-step-option" onclick="addStep('visit')">üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</button>
                                <button class="add-step-option" onclick="addStep('wait')">‚è≥ ‡∏£‡∏≠</button>
                                <button class="add-step-option" onclick="addStep('admin')">üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
                                <button class="add-step-option" onclick="addStep('notify')">üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤</button>
                                <button class="add-step-option" onclick="addStep('send')">üìß ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                            </div>
                        </div>

                        <!-- STEP 3 -->
                        <div class="step-card" draggable="true" data-step="3" onclick="selectStep(this, 3)">
                            <div class="step-card-header">
                                <span class="step-drag-handle">‚†ø</span>
                                <div class="step-number">3</div>
                                <div class="step-info">
                                    <div class="step-name">üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2</div>
                                    <div class="step-timing">Day 4 ¬∑ Same CO</div>
                                </div>
                                <div class="step-actions">
                                    <button class="step-action-btn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
                                        onclick="event.stopPropagation(); selectStep(this.closest('.step-card'), 3)">‚úèÔ∏è</button>
                                    <button class="step-action-btn delete" title="‡∏•‡∏ö"
                                        onclick="event.stopPropagation()">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="step-outcomes">
                                <div class="step-outcomes-label">Outcome Transitions</div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot green"></span> PTP</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target success">‚úÖ ‡∏à‡∏ö Playbook (‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot red"></span> ‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">‚è≠Ô∏è Step 5: üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot red"></span> ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏ä‡∏≥‡∏£‡∏∞</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target danger">‚è≠Ô∏è Step 6: üìã ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot blue"></span> Default</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">‚è≠Ô∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                                </div>
                            </div>
                        </div>

                        <div class="step-connector">
                            <button class="add-step-btn" onclick="toggleAddMenu(this)" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô">+</button>
                            <div class="add-step-dropdown">
                                <button class="add-step-option" onclick="addStep('call')">üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</button>
                                <button class="add-step-option" onclick="addStep('visit')">üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</button>
                                <button class="add-step-option" onclick="addStep('wait')">‚è≥ ‡∏£‡∏≠</button>
                                <button class="add-step-option" onclick="addStep('admin')">üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
                                <button class="add-step-option" onclick="addStep('notify')">üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤</button>
                                <button class="add-step-option" onclick="addStep('send')">üìß ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                            </div>
                        </div>

                        <!-- STEP 4 -->
                        <div class="step-card" draggable="true" data-step="4" onclick="selectStep(this, 4)">
                            <div class="step-card-header">
                                <span class="step-drag-handle">‚†ø</span>
                                <div class="step-number">4</div>
                                <div class="step-info">
                                    <div class="step-name">‚è≥ ‡∏£‡∏≠</div>
                                    <div class="step-timing">3 ‡∏ß‡∏±‡∏ô ¬∑ ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
                                </div>
                                <div class="step-actions">
                                    <button class="step-action-btn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
                                        onclick="event.stopPropagation(); selectStep(this.closest('.step-card'), 4)">‚úèÔ∏è</button>
                                    <button class="step-action-btn delete" title="‡∏•‡∏ö"
                                        onclick="event.stopPropagation()">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="step-outcomes">
                                <div class="step-outcomes-label">Outcome Transitions</div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot blue"></span> ‡∏Ñ‡∏£‡∏ö‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">‚è≠Ô∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                                </div>
                            </div>
                        </div>

                        <div class="step-connector">
                            <button class="add-step-btn" onclick="toggleAddMenu(this)" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô">+</button>
                            <div class="add-step-dropdown">
                                <button class="add-step-option" onclick="addStep('call')">üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</button>
                                <button class="add-step-option" onclick="addStep('visit')">üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</button>
                                <button class="add-step-option" onclick="addStep('wait')">‚è≥ ‡∏£‡∏≠</button>
                                <button class="add-step-option" onclick="addStep('admin')">üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
                                <button class="add-step-option" onclick="addStep('notify')">üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤</button>
                                <button class="add-step-option" onclick="addStep('send')">üìß ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                            </div>
                        </div>

                        <!-- STEP 5 -->
                        <div class="step-card" draggable="true" data-step="5" onclick="selectStep(this, 5)">
                            <div class="step-card-header">
                                <span class="step-drag-handle">‚†ø</span>
                                <div class="step-number">5</div>
                                <div class="step-info">
                                    <div class="step-name">üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</div>
                                    <div class="step-timing">Day 7 ¬∑ Same CO</div>
                                </div>
                                <div class="step-actions">
                                    <button class="step-action-btn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç"
                                        onclick="event.stopPropagation(); selectStep(this.closest('.step-card'), 5)">‚úèÔ∏è</button>
                                    <button class="step-action-btn delete" title="‡∏•‡∏ö"
                                        onclick="event.stopPropagation()">üóëÔ∏è</button>
                                </div>
                            </div>
                            <div class="step-outcomes">
                                <div class="step-outcomes-label">Outcome Transitions</div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot green"></span> ‡∏û‡∏ö & PTP</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target success">‚úÖ ‡∏à‡∏ö Playbook (‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot red"></span> ‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">‚è≠Ô∏è Step 6: üìã ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot red"></span> ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target danger">‚è≠Ô∏è Step 6: üìã ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot gray"></span> ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å
                                    </div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target danger">‚ùå ‡∏à‡∏ö Playbook (‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß)</div>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot blue"></span> Default</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target">‚è≠Ô∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
                                </div>
                            </div>
                        </div>

                        <div class="step-connector">
                            <button class="add-step-btn" onclick="toggleAddMenu(this)" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô">+</button>
                            <div class="add-step-dropdown">
                                <button class="add-step-option" onclick="addStep('call')">üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</button>
                                <button class="add-step-option" onclick="addStep('visit')">üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</button>
                                <button class="add-step-option" onclick="addStep('wait')">‚è≥ ‡∏£‡∏≠</button>
                                <button class="add-step-option" onclick="addStep('admin')">üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
                                <button class="add-step-option" onclick="addStep('notify')">üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤</button>
                                <button class="add-step-option" onclick="addStep('send')">üìß ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
                            </div>
                        </div>

                        <!-- STEP 6 (LOCKED) -->
                        <div class="step-card locked" draggable="false" data-step="6" onclick="selectStep(this, 6)">
                            <div class="step-card-header">
                                <span class="step-drag-handle" style="cursor:not-allowed;opacity:0.3;">‚†ø</span>
                                <div class="step-number">6</div>
                                <div class="step-info">
                                    <div class="step-name">üìã ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô <span class="tag tag-gray"
                                            style="font-size:10px;">üîí ‡∏•‡πá‡∏≠‡∏Ñ</span></div>
                                    <div class="step-timing">Day 8 ¬∑ Same CO ¬∑ HQ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                                </div>
                                <div class="step-actions">
                                    <button class="step-action-btn" title="‡∏î‡∏π (‡∏•‡πá‡∏≠‡∏Ñ)"
                                        onclick="event.stopPropagation(); selectStep(this.closest('.step-card'), 6)">üëÅÔ∏è</button>
                                </div>
                            </div>
                            <div class="step-outcomes">
                                <div class="step-outcomes-label">Outcome Transitions <span
                                        style="font-weight:400;color:var(--color-text-tertiary);">(üîí ‡∏î‡∏π‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</span>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot green"></span> Completed</div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target" style="opacity:0.7;cursor:default;">‚è≠Ô∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step-connector">
                            <button class="add-step-btn" style="opacity:0;cursor:default;" disabled>+</button>
                        </div>

                        <!-- STEP 7 (LOCKED) -->
                        <div class="step-card locked" draggable="false" data-step="7" onclick="selectStep(this, 7)">
                            <div class="step-card-header">
                                <span class="step-drag-handle" style="cursor:not-allowed;opacity:0.3;">‚†ø</span>
                                <div class="step-number">7</div>
                                <div class="step-info">
                                    <div class="step-name">üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤ <span class="tag tag-gray"
                                            style="font-size:10px;">üîí ‡∏•‡πá‡∏≠‡∏Ñ</span></div>
                                    <div class="step-timing">‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ¬∑ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏à‡∏ö Playbook ¬∑ HQ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î</div>
                                </div>
                                <div class="step-actions">
                                    <button class="step-action-btn" title="‡∏î‡∏π (‡∏•‡πá‡∏≠‡∏Ñ)"
                                        onclick="event.stopPropagation(); selectStep(this.closest('.step-card'), 7)">üëÅÔ∏è</button>
                                </div>
                            </div>
                            <div class="step-outcomes">
                                <div class="step-outcomes-label">Outcome Transitions <span
                                        style="font-weight:400;color:var(--color-text-tertiary);">(üîí ‡∏î‡∏π‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)</span>
                                </div>
                                <div class="outcome-row">
                                    <div class="outcome-label"><span class="outcome-dot green"></span> Acknowledged
                                    </div>
                                    <span class="outcome-arrow">‚Üí</span>
                                    <div class="outcome-target success" style="opacity:0.7;cursor:default;">‚úÖ ‡∏à‡∏ö
                                        Playbook</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Config Panel -->
                    <div class="config-panel" id="configPanel">
                        <div class="config-panel-header">
                            <span class="config-panel-title">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</span>
                            <button class="step-action-btn" onclick="deselectStep()" title="‡∏õ‡∏¥‡∏î">‚úï</button>
                        </div>
                        <div class="config-panel-body" id="configBody">
                            <div class="config-info" style="text-align:center;padding:32px 12px;">
                                <span style="font-size:32px;display:block;margin-bottom:8px;">üëÜ</span>
                                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="editor-footer">
                <div class="editor-footer-left">
                    <span class="unsaved-dot"></span>
                    <span>‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
                </div>
                <div style="display:flex;gap:8px;">
                    <a href="supervisor.html" class="btn btn-outline">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
                    <button class="btn btn-primary" onclick="savePlaybook()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // === Drag & Drop ===
        let dragSrcEl = null;

        document.querySelectorAll('.step-card[draggable="true"]').forEach(card => {
            card.addEventListener('dragstart', handleDragStart);
            card.addEventListener('dragend', handleDragEnd);
            card.addEventListener('dragover', handleDragOver);
            card.addEventListener('dragenter', handleDragEnter);
            card.addEventListener('dragleave', handleDragLeave);
            card.addEventListener('drop', handleDrop);
        });

        function handleDragStart(e) {
            dragSrcEl = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.dataset.step);
        }

        function handleDragEnd() {
            this.classList.remove('dragging');
            document.querySelectorAll('.step-card').forEach(c => c.classList.remove('drag-over'));
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            if (this !== dragSrcEl && this.draggable) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave() {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            if (this !== dragSrcEl && this.draggable) {
                const pipeline = document.getElementById('pipeline');
                const allCards = [...pipeline.querySelectorAll('.step-card')];
                const srcIndex = allCards.indexOf(dragSrcEl);
                const dstIndex = allCards.indexOf(this);

                // Get all pipeline children (cards + connectors)
                const children = [...pipeline.children];
                const srcChild = children.indexOf(dragSrcEl);
                const dstChild = children.indexOf(this);

                if (srcIndex < dstIndex) {
                    // Moving down: insert after destination's connector
                    const nextConnector = this.nextElementSibling;
                    if (nextConnector) {
                        const srcConnector = dragSrcEl.previousElementSibling;
                        pipeline.insertBefore(dragSrcEl, nextConnector.nextElementSibling);
                        if (srcConnector && srcConnector.classList.contains('step-connector')) {
                            pipeline.insertBefore(srcConnector, dragSrcEl);
                        }
                    }
                } else {
                    // Moving up: insert before destination
                    const srcConnector = dragSrcEl.nextElementSibling;
                    pipeline.insertBefore(dragSrcEl, this);
                    if (srcConnector && srcConnector.classList.contains('step-connector')) {
                        pipeline.insertBefore(srcConnector, dragSrcEl.nextElementSibling);
                    }
                }

                renumberSteps();
            }
            this.classList.remove('drag-over');
        }

        function renumberSteps() {
            const cards = document.querySelectorAll('.step-card');
            cards.forEach((card, i) => {
                card.dataset.step = i + 1;
                card.querySelector('.step-number').textContent = i + 1;
            });
        }

        // === Step Selection ===
        function selectStep(card, stepNum) {
            document.querySelectorAll('.step-card').forEach(c => c.classList.remove('selected'));
            card.classList.add('selected');

            const isLocked = card.classList.contains('locked');
            const stepName = card.querySelector('.step-name').textContent.replace(/üîí.*/, '').trim();
            const stepTiming = card.querySelector('.step-timing').textContent;

            const configBody = document.getElementById('configBody');

            if (isLocked) {
                configBody.innerHTML = `
      <div class="config-section">
        <div class="config-info" style="border-left:3px solid #9CA3AF;">
          <strong>üîí ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Å‡πÇ‡∏î‡∏¢ HQ</strong><br>
          <span style="margin-top:4px;display:block;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Outcome ‡πÑ‡∏î‡πâ</span>
        </div>
      </div>
      <div class="config-section">
        <label class="config-label">‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</label>
        <div class="config-info">${stepName}</div>
      </div>
      <div class="config-section">
        <label class="config-label">Timing</label>
        <div class="config-info">${stepTiming}</div>
      </div>
      <div class="config-section">
        <label class="config-label">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
        <div class="config-info">Same CO (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà HQ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î)</div>
      </div>
    `;
            } else {
                configBody.innerHTML = `
      <div class="config-section">
        <label class="config-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏á‡∏≤‡∏ô</label>
        <select class="config-select">
          <option ${stepName.includes('‡πÇ‡∏ó‡∏£') ? 'selected' : ''}>üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</option>
          <option ${stepName.includes('‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà') ? 'selected' : ''}>üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</option>
          <option ${stepName.includes('‡∏£‡∏≠') ? 'selected' : ''}>‚è≥ ‡∏£‡∏≠</option>
          <option ${stepName.includes('‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ') || stepName.includes('‡∏™‡πà‡∏á') ? 'selected' : ''}>üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
          <option>üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤</option>
          <option>üìß ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</option>
        </select>
      </div>
      <div class="config-section">
        <label class="config-label">‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô</label>
        <input type="text" class="form-input" value="${stepName}">
      </div>
      <div class="config-section">
        <label class="config-label">Timing</label>
        <div style="display:flex;gap:8px;">
          <input type="number" class="form-input" value="1" style="width:60px;">
          <select class="config-select" style="flex:1;">
            <option>‡∏ß‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</option>
            <option>‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</option>
            <option selected>‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏° Playbook</option>
          </select>
        </div>
      </div>
      <div class="config-section">
        <label class="config-label">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
        <select class="config-select">
          <option selected>Same CO (‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°)</option>
          <option>Branch Supervisor</option>
          <option>Auto-escalate</option>
        </select>
      </div>
      <div class="config-section">
        <label class="config-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà (Retry)</label>
        <input type="number" class="form-input" value="3" min="0" max="10" style="width:80px;">
        <span style="font-size:11px;color:var(--color-text-tertiary);margin-top:4px;display:block;">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Outcome "‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö‡∏™‡∏≤‡∏¢" ‚Äî ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ</span>
      </div>
      <div class="config-section">
        <label class="config-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
        <textarea class="form-input" style="height:60px;padding:8px 12px;resize:none;" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á..."></textarea>
      </div>
    `;
            }
        }

        function deselectStep() {
            document.querySelectorAll('.step-card').forEach(c => c.classList.remove('selected'));
            document.getElementById('configBody').innerHTML = `
    <div class="config-info" style="text-align:center;padding:32px 12px;">
      <span style="font-size:32px;display:block;margin-bottom:8px;">üëÜ</span>
      ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
    </div>
  `;
        }

        // === Add Step ===
        function toggleAddMenu(btn) {
            const dropdown = btn.nextElementSibling;
            // Close all others
            document.querySelectorAll('.add-step-dropdown').forEach(d => {
                if (d !== dropdown) d.classList.remove('visible');
            });
            dropdown.classList.toggle('visible');
        }

        function addStep(type) {
            const types = {
                call: { name: 'üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡πÉ‡∏´‡∏°‡πà)', timing: '1 ‡∏ß‡∏±‡∏ô ¬∑ Same CO' },
                visit: { name: 'üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (‡πÉ‡∏´‡∏°‡πà)', timing: '1 ‡∏ß‡∏±‡∏ô ¬∑ Same CO' },
                wait: { name: '‚è≥ ‡∏£‡∏≠ (‡πÉ‡∏´‡∏°‡πà)', timing: '1 ‡∏ß‡∏±‡∏ô ¬∑ ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥' },
                admin: { name: 'üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡πÉ‡∏´‡∏°‡πà)', timing: '1 ‡∏ß‡∏±‡∏ô ¬∑ Same CO' },
                notify: { name: 'üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤ (‡πÉ‡∏´‡∏°‡πà)', timing: '‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥' },
                send: { name: 'üìß ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡πÉ‡∏´‡∏°‡πà)', timing: '‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥' }
            };

            const t = types[type];
            const newCard = document.createElement('div');
            newCard.className = 'step-card selected';
            newCard.draggable = true;
            newCard.dataset.step = '0';
            newCard.setAttribute('onclick', `selectStep(this, parseInt(this.dataset.step))`);
            newCard.innerHTML = `
    <div class="step-card-header">
      <span class="step-drag-handle">‚†ø</span>
      <div class="step-number" style="background:var(--color-success)">‚úì</div>
      <div class="step-info">
        <div class="step-name">${t.name}</div>
        <div class="step-timing">${t.timing}</div>
      </div>
      <div class="step-actions">
        <button class="step-action-btn" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" onclick="event.stopPropagation()">‚úèÔ∏è</button>
        <button class="step-action-btn delete" title="‡∏•‡∏ö" onclick="event.stopPropagation(); this.closest('.step-card').remove(); renumberSteps();">üóëÔ∏è</button>
      </div>
    </div>
    <div class="step-outcomes">
      <div class="step-outcomes-label">Outcome Transitions</div>
      <div class="outcome-row">
        <div class="outcome-label"><span class="outcome-dot blue"></span> Default</div>
        <span class="outcome-arrow">‚Üí</span>
        <div class="outcome-target">‚è≠Ô∏è ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
      </div>
    </div>
  `;

            // Find which connector's dropdown was clicked
            const openDropdown = document.querySelector('.add-step-dropdown.visible');
            if (openDropdown) {
                const connector = openDropdown.parentElement;
                connector.parentElement.insertBefore(newCard, connector.nextElementSibling);

                // Add a new connector after the new card
                const newConnector = document.createElement('div');
                newConnector.className = 'step-connector';
                newConnector.innerHTML = `
      <button class="add-step-btn" onclick="toggleAddMenu(this)" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô">+</button>
      <div class="add-step-dropdown">
        <button class="add-step-option" onclick="addStep('call')">üìû ‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</button>
        <button class="add-step-option" onclick="addStep('visit')">üè† ‡∏•‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</button>
        <button class="add-step-option" onclick="addStep('wait')">‚è≥ ‡∏£‡∏≠</button>
        <button class="add-step-option" onclick="addStep('admin')">üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
        <button class="add-step-option" onclick="addStep('notify')">üîî ‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤</button>
        <button class="add-step-option" onclick="addStep('send')">üìß ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
      </div>
    `;
                newCard.parentElement.insertBefore(newConnector, newCard.nextElementSibling);

                openDropdown.classList.remove('visible');
            }

            // Setup drag & drop for new card
            newCard.addEventListener('dragstart', handleDragStart);
            newCard.addEventListener('dragend', handleDragEnd);
            newCard.addEventListener('dragover', handleDragOver);
            newCard.addEventListener('dragenter', handleDragEnter);
            newCard.addEventListener('dragleave', handleDragLeave);
            newCard.addEventListener('drop', handleDrop);

            renumberSteps();
            selectStep(newCard, parseInt(newCard.dataset.step));
        }

        function savePlaybook() {
            alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Playbook "‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡∏µ‡πâ‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞" ‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏≤‡∏Ç‡∏≤‡∏£‡∏±‡∏ä‡∏î‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
            window.location.href = 'supervisor.html';
        }

        // Close dropdowns on outside click
        document.addEventListener('click', (e) => {
            if (!e.target.classList.contains('add-step-btn')) {
                document.querySelectorAll('.add-step-dropdown').forEach(d => d.classList.remove('visible'));
            }
        });
    </script>
</body>

</html>